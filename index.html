<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Class Platform</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { --primary: #6366f1; --bg-body: #f3f4f6; --bg-card: #ffffff; --text-main: #1f2937; --border: #e5e7eb; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg-body); margin: 0; color: var(--text-main); }
        
        /* --- LOGIN OVERLAY --- */
        #login-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #eef2ff; z-index: 9999; display: flex; align-items: center; justify-content: center; }
        .login-card { background: white; padding: 40px; border-radius: 16px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 350px; text-align: center; }
        .login-input { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        .login-btn { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }

        /* Navbar & Layout */
        .navbar { background: var(--bg-card); padding: 0 20px; height: 60px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 100; }
        .logo { font-weight: 800; color: var(--primary); font-size: 22px; display:flex; align-items:center; gap:5px; cursor: pointer; }
        .main-layout { display: grid; grid-template-columns: 260px 1fr; gap: 20px; max-width: 1200px; margin: 20px auto; padding: 0 15px; }
        
        /* Sidebar */
        .sidebar { background: var(--bg-card); border-radius: 12px; padding: 15px; height: fit-content; border: 1px solid var(--border); position: sticky; top: 80px; }
        .menu-item { padding: 12px; cursor: pointer; border-radius: 8px; display: flex; align-items: center; gap: 12px; color: #4b5563; font-weight: 500; transition: 0.2s; margin-bottom: 5px; }
        .menu-item:hover { background: #f3f4f6; color: var(--primary); }
        .menu-item.active { background: #eef2ff; color: var(--primary); border-left: 4px solid var(--primary); }
        
        /* Sections */
        .section { display: none; animation: fadeIn 0.3s; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* --- COURSE STYLES --- */
        .course-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .course-card { background: white; border-radius: 12px; overflow: hidden; border: 1px solid var(--border); cursor: pointer; transition: 0.2s; }
        .course-card:hover { transform: translateY(-5px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .course-thumb { height: 150px; background: #ddd; display: flex; align-items: center; justify-content: center; font-size: 40px; color: white; }
        .course-info { padding: 15px; }
        
        /* Video Player Layout */
        .video-layout { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; }
        .video-player { width: 100%; aspect-ratio: 16/9; background: black; border-radius: 12px; margin-bottom: 15px; }
        .lesson-list { background: white; border: 1px solid var(--border); border-radius: 12px; padding: 10px; max-height: 500px; overflow-y: auto; }
        .lesson-item { padding: 10px; border-bottom: 1px solid #eee; cursor: pointer; display: flex; gap: 10px; align-items: center; }
        .lesson-item:hover { background: #f9fafb; }
        .lesson-item.active { background: #eef2ff; color: var(--primary); font-weight: bold; }

        /* Settings */
        .settings-group { background: white; padding: 20px; border-radius: 12px; border: 1px solid var(--border); margin-bottom: 20px; }
        .form-label { display: block; margin-bottom: 8px; font-weight: bold; font-size: 14px; }
        .form-input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; margin-bottom: 15px; }
        .btn-danger { background: #ef4444; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; }

        /* Feed & Generator Styles (Reused) */
        .create-post, .gen-card, .post { background: white; padding: 20px; border-radius: 12px; border: 1px solid var(--border); margin-bottom: 20px; }
        .btn-gen { width: 100%; padding: 12px; background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; border: none; border-radius: 10px; cursor: pointer; margin-top:10px;}
        .input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }

        @media (max-width: 768px) { .main-layout, .video-layout { grid-template-columns: 1fr; } .sidebar { display: none; } }
    </style>
</head>
<body>

    <div id="login-overlay">
        <div class="login-card">
            <h2 style="color:var(--primary); margin-bottom:20px;">üöÄ MyClass Login</h2>
            <input type="email" id="loginEmail" class="login-input" placeholder="Email Address" value="student@myclass.com">
            <input type="password" id="loginPass" class="login-input" placeholder="Password (Use: 123456)">
            <button class="login-btn" onclick="handleLogin()">Login</button>
            <p style="margin-top:15px; font-size:12px; color:gray;">Demo Password: 123456</p>
        </div>
    </div>

    <div id="app-content" style="display:none;">
        
        <nav class="navbar">
            <div class="logo" onclick="location.reload()"><span>üöÄ MyClass</span></div>
            <div style="display:flex; align-items:center; gap:10px;">
                <span id="userDisplay" style="font-weight:bold;">Student</span>
                <div style="width:35px; height:35px; background:var(--primary); color:white; border-radius:50%; display:flex; align-items:center; justify-content:center;">U</div>
            </div>
        </nav>

        <div class="main-layout">
            <aside class="sidebar">
                <div class="menu-item active" id="nav-feed" onclick="switchTab('feed')"><i class="fas fa-home"></i> Feed</div>
                <div class="menu-item" id="nav-gen" onclick="switchTab('generator')"><i class="fas fa-magic"></i> AI Generator</div>
                <div class="menu-item" id="nav-courses" onclick="switchTab('courses')"><i class="fas fa-book"></i> My Learning</div>
                <div class="menu-item" id="nav-settings" onclick="switchTab('settings')"><i class="fas fa-cog"></i> Settings</div>
                <div class="menu-item" onclick="location.reload()" style="color:red;"><i class="fas fa-sign-out-alt"></i> Logout</div>
            </aside>

            <main>
                
                <div id="feed-section" class="section active">
                    <div class="create-post">
                        <textarea id="postInput" style="width:100%; border:none; outline:none;" rows="3" placeholder="What's on your mind?"></textarea>
                        <button onclick="addPost()" style="background:var(--primary); color:white; border:none; padding:8px 20px; border-radius:6px; float:right; cursor:pointer;">Post</button>
                        <div style="clear:both;"></div>
                    </div>
                    <div id="feedStream"><div style="text-align:center; padding:20px; color:gray;">Loading Feed...</div></div>
                </div>

                <div id="generator-section" class="section">
                    <div class="gen-card">
                        <h2 style="margin-top:0;">‚ú® AI Content Generator</h2>
                        <label style="display:block; font-weight:bold; font-size:12px; margin-bottom:5px;">Topic</label>
                        <input type="text" id="topic" class="form-input" placeholder="e.g. Promotion...">
                        
                        <div class="input-grid">
                            <select id="platform" class="form-input"><option value="Facebook">Facebook</option><option value="TikTok">TikTok</option></select>
                            <select id="tone" class="form-input"><option value="Professional">Professional</option><option value="Funny">Funny</option></select>
                        </div>

                        <button class="btn-gen" id="genBtn" onclick="generateContent()">Generate Content</button>
                        <div class="result-box" id="output" style="background:#f8f9fa; padding:15px; margin-top:15px; border-radius:8px; min-height:100px;"></div>
                        <button onclick="sendToFeed()" id="useBtn" style="display:none; background:#10b981; color:white; border:none; padding:10px; width:100%; margin-top:10px; border-radius:8px; cursor:pointer;">Use this Post</button>
                    </div>
                </div>

                <div id="courses-section" class="section">
                    <div id="course-list-view">
                        <h2>üéì My Learning</h2>
                        <div class="course-grid">
                            <div class="course-card" onclick="openCourse('webdev')">
                                <div class="course-thumb" style="background:#3b82f6;">üíª</div>
                                <div class="course-info">
                                    <h3 style="margin:0 0 5px 0;">Web Development</h3>
                                    <p style="margin:0; font-size:13px; color:gray;">HTML, CSS, JavaScript Basics</p>
                                </div>
                            </div>
                            <div class="course-card" onclick="openCourse('digitalmarketing')">
                                <div class="course-thumb" style="background:#ec4899;">üìà</div>
                                <div class="course-info">
                                    <h3 style="margin:0 0 5px 0;">Digital Marketing</h3>
                                    <p style="margin:0; font-size:13px; color:gray;">Social Media Strategy & SEO</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="course-player-view" style="display:none;">
                        <button onclick="backToCourses()" style="margin-bottom:15px; cursor:pointer; border:none; background:none; color:var(--primary); font-weight:bold;">‚Üê Back to Courses</button>
                        <h2 id="courseTitle" style="margin-top:0;">Course Title</h2>
                        
                        <div class="video-layout">
                            <div>
                                <iframe id="mainVideo" class="video-player" src="" frameborder="0" allowfullscreen></iframe>
                                <h3 id="videoTitle">Select a video</h3>
                            </div>
                            <div class="lesson-list" id="lessonList">
                                </div>
                        </div>
                    </div>
                </div>

                <div id="settings-section" class="section">
                    <h2>‚öôÔ∏è Settings</h2>
                    
                    <div class="settings-group">
                        <h3>Account Information</h3>
                        <label class="form-label">Full Name</label>
                        <input type="text" class="form-input" value="Mg Mg">
                        <label class="form-label">Email</label>
                        <input type="text" class="form-input" value="student@myclass.com" readonly style="background:#eee;">
                    </div>

                    <div class="settings-group">
                        <h3>Security</h3>
                        <label class="form-label">Current Password</label>
                        <input type="password" class="form-input">
                        <label class="form-label">New Password</label>
                        <input type="password" class="form-input">
                        <button class="login-btn" style="width:auto;">Update Password</button>
                    </div>

                    <div class="settings-group" style="border-color:#fca5a5;">
                        <h3 style="color:#ef4444;">Danger Zone</h3>
                        <p style="font-size:13px; color:gray;">Once you delete your account, there is no going back.</p>
                        <button class="btn-danger" onclick="alert('Contact Admin to delete account.')">Delete Account</button>
                    </div>
                </div>

            </main>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, serverTimestamp } 
        from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAFLolC6hEYro24FAFrKTGrXe4WXvISv3M",
            authDomain: "myclassfeed-766f9.firebaseapp.com",
            projectId: "myclassfeed-766f9",
            storageBucket: "myclassfeed-766f9.firebasestorage.app",
            messagingSenderId: "428491793200",
            appId: "1:428491793200:web:dc8b769278b0e981d29ef5"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- üîê KEYS & CONFIG ---
        const ENCODED_KEY = "QUl6YVN5Q1Z6YUEyQlJGYndfbmcxVmpRWldYNU55TlAtZlItYURR"; 
        const MODEL_NAME = "gemini-2.5-flash";

        // --- LOGIN LOGIC ---
        window.handleLogin = function() {
            const email = document.getElementById('loginEmail').value;
            const pass = document.getElementById('loginPass').value;

            // Simple Check for Demo (Password must be 123456)
            if(pass === "123456") {
                document.getElementById('login-overlay').style.display = "none";
                document.getElementById('app-content').style.display = "block";
            } else {
                alert("Password Incorrect! (Demo Pass: 123456)");
            }
        }

        // --- NAVIGATION LOGIC ---
        window.switchTab = function(tab) {
            document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active'));

            if(tab === 'feed') { document.getElementById('feed-section').classList.add('active'); document.getElementById('nav-feed').classList.add('active'); }
            if(tab === 'generator') { document.getElementById('generator-section').classList.add('active'); document.getElementById('nav-gen').classList.add('active'); }
            if(tab === 'courses') { document.getElementById('courses-section').classList.add('active'); document.getElementById('nav-courses').classList.add('active'); }
            if(tab === 'settings') { document.getElementById('settings-section').classList.add('active'); document.getElementById('nav-settings').classList.add('active'); }
        }

        // --- COURSE DATA & LOGIC ---
        const coursesData = {
            'webdev': {
                title: "Web Development Bootcamp",
                videos: [
                    { title: "HTML in 100 Seconds", id: "ok-plXXHlWw" },
                    { title: "CSS Basics", id: "1Rs2ND1ryYc" },
                    { title: "JavaScript Crash Course", id: "hdI2bqOjy3c" },
                    { title: "Firebase Tutorial", id: "9kRgVxULbag" },
                    { title: "Build a Website", id: "pQN-pnXPaVg" }
                ]
            },
            'digitalmarketing': {
                title: "Digital Marketing Practice",
                videos: [
                    { title: "Digital Marketing 101", id: "bixR-KIJKYM" },
                    { title: "Social Media Strategy", id: "U5i80B0O_h4" },
                    { title: "Content Marketing", id: "2503R0J_040" },
                    { title: "SEO Basics", id: "DvwS7cV9GmQ" },
                    { title: "Facebook Ads Tutorial", id: "1Kk6Cg0Pz9s" }
                ]
            }
        };

        window.openCourse = function(courseId) {
            const course = coursesData[courseId];
            document.getElementById('course-list-view').style.display = 'none';
            document.getElementById('course-player-view').style.display = 'block';
            
            document.getElementById('courseTitle').innerText = course.title;
            const list = document.getElementById('lessonList');
            list.innerHTML = "";

            course.videos.forEach((vid, index) => {
                const div = document.createElement('div');
                div.className = "lesson-item";
                div.innerHTML = `<span>‚ñ∂Ô∏è</span> ${vid.title}`;
                div.onclick = () => playVideo(vid.id, vid.title);
                list.appendChild(div);
                
                // Play first video automatically
                if(index === 0) playVideo(vid.id, vid.title);
            });
        }

        window.playVideo = function(vidId, title) {
            document.getElementById('mainVideo').src = "https://www.youtube.com/embed/" + vidId;
            document.getElementById('videoTitle').innerText = title;
        }

        window.backToCourses = function() {
            document.getElementById('course-player-view').style.display = 'none';
            document.getElementById('course-list-view').style.display = 'block';
            document.getElementById('mainVideo').src = ""; // Stop video
        }

        // --- GENERATOR & FEED LOGIC (Existing) ---
        window.generateContent = async function() {
            const topic = document.getElementById('topic').value;
            const platform = document.getElementById('platform').value;
            const tone = document.getElementById('tone').value;
            const output = document.getElementById('output');
            const btn = document.getElementById('genBtn');

            if(!topic) { alert("Please enter topic"); return; }

            let REAL_KEY = "";
            try { REAL_KEY = atob(ENCODED_KEY); } catch(e) { return; }

            btn.disabled = true; btn.innerText = "Generating...";
            const prompt = `Write a ${tone} post for ${platform} about: "${topic}" in Burmese.`;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${REAL_KEY}`, {
                    method: "POST", headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                const data = await response.json();
                if(!response.ok) { output.innerText = "Error: " + JSON.stringify(data); }
                else { output.innerText = data.candidates[0].content.parts[0].text; document.getElementById('useBtn').style.display = 'block'; }
            } catch(e) { output.innerText = "Error"; }
            btn.disabled = false; btn.innerText = "Generate Content";
        }

        window.sendToFeed = () => { window.switchTab('feed'); document.getElementById('postInput').value = document.getElementById('output').innerText; }
        window.addPost = async () => {
            const txt = document.getElementById('postInput').value;
            if(!txt) return;
            await addDoc(collection(db, "posts"), { content: txt, username: "Student", timestamp: serverTimestamp() });
            document.getElementById('postInput').value = "";
        }
        const q = query(collection(db, "posts"), orderBy("timestamp", "desc"));
        onSnapshot(q, (s) => {
            const f = document.getElementById('feedStream'); f.innerHTML = "";
            s.forEach(d => f.innerHTML += `<div class="post"><div class="post-header"><div class="avatar">S</div><div style="font-weight:bold;">Student</div></div><div style="white-space:pre-wrap;">${d.data().content}</div></div>`);
        });
    </script>
</body>
</html>
