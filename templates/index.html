<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creative AI Content</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Padauk:wght@400;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <style>
        body { font-family: 'Inter', 'Padauk', sans-serif; background: #f3f4f6; }
        .preview-card { background: white; border-radius: 12px; border: 1px solid #e5e7eb; overflow: hidden; }
        .loader { width: 18px; height: 18px; border: 2px solid #fff; border-top: 2px solid transparent; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        /* Custom Button Select Styles */
        .btn-select { cursor: pointer; transition: all 0.2s; border: 1px solid #e5e7eb; }
        .btn-select.active { background: #2563eb; color: white; border-color: #2563eb; }
    </style>
</head>
<body class="min-h-screen p-4 flex justify-center">

    {% if show_login %}
    <div class="bg-white p-8 rounded-xl shadow-lg w-full max-w-md self-center">
        <h2 class="text-2xl font-bold text-center text-gray-800 mb-6">üîí Login</h2>
        {% if error %}<p class="text-red-500 text-center mb-4 text-sm">{{ error }}</p>{% endif %}
        <form method="POST">
            <input type="password" name="password" placeholder="Password..." required class="w-full p-3 border rounded-lg mb-4 outline-none focus:border-blue-500">
            <button type="submit" class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 transition">Log In</button>
        </form>
    </div>
    {% else %}
    
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 w-full max-w-7xl">
        <div class="lg:col-span-5 bg-white p-6 rounded-xl shadow-sm h-fit">
            <div class="flex justify-between items-center mb-4">
                <h1 class="text-xl font-bold text-blue-600"><i class="fas fa-brain mr-2"></i>Creative AI</h1>
                <a href="/logout" class="text-gray-400 hover:text-red-500"><i class="fas fa-power-off"></i></a>
            </div>
            <div class="space-y-4">
                
                <input type="text" id="topic" placeholder="What to write about?" class="w-full p-3 border rounded-lg bg-gray-50 focus:bg-white outline-none focus:ring-2 focus:ring-blue-500 font-medium">

                <div class="grid grid-cols-2 gap-2">
                    <select id="ai_model" class="p-2 border rounded-lg text-sm bg-blue-50 font-bold text-blue-700"><option>Gemini 2.5 Flash</option><option>Gemini 3.0 Pro</option><option>DeepSeek</option><option>ChatGPT</option></select>
                    <select id="language" class="p-2 border rounded-lg text-sm bg-blue-50 font-bold text-blue-700"><option>Myanglish</option><option>Pure Burmese</option><option>English Only</option></select>
                </div>

                <div class="bg-gray-50 p-3 rounded-lg border">
                    <label class="text-xs font-bold text-gray-500 uppercase mb-1 block">Creativity Level</label>
                    <select id="creativity" class="w-full p-2 border rounded text-sm mb-3 font-medium">
                        <option value="Standard">Standard (·Äõ·Ä≠·ÄØ·Ä∏·Äõ·Ä≠·ÄØ·Ä∏)</option>
                        <option value="Storytelling">Storytelling (·Äá·Ä¨·Äê·Ä∫·Äú·Äô·Ä∫·Ä∏·ÄÜ·ÄÑ·Ä∫)</option>
                        <option value="Viral/Hook">Viral Hook (·Äï·Ä±·Ä´·ÄÄ·Ä∫·Ä°·Ä±·Ä¨·ÄÑ·Ä∫·Äõ·Ä±·Ä∏)</option>
                        <option value="Direct/Sales">Direct Sales (·Äõ·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·ÄÖ·ÄÄ·Ä¨·Ä∏)</option>
                    </select>

                    <label class="text-xs font-bold text-gray-500 uppercase mb-1 block">Length</label>
                    <div class="grid grid-cols-3 gap-2">
                        <div onclick="setLength('Short')" id="lenShort" class="btn-select p-2 rounded text-center text-xs font-bold text-gray-600 bg-white">Short</div>
                        <div onclick="setLength('Medium')" id="lenMedium" class="btn-select active p-2 rounded text-center text-xs font-bold text-gray-600 bg-white">Medium</div>
                        <div onclick="setLength('Long')" id="lenLong" class="btn-select p-2 rounded text-center text-xs font-bold text-gray-600 bg-white">Long</div>
                    </div>
                    <input type="hidden" id="length" value="Medium">
                </div>

                <div class="grid grid-cols-2 gap-2">
                    <select id="platform" class="p-2 border rounded text-sm bg-gray-50" onchange="renderPreview()"><option>Facebook</option><option>Instagram</option><option>LinkedIn</option><option>TikTok</option></select>
                    <select id="tone" class="p-2 border rounded text-sm bg-gray-50"><option>Professional</option><option>Funny</option><option>Emotional</option></select>
                </div>

                <button onclick="generate()" id="genBtn" class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white font-bold py-3 rounded-lg shadow hover:shadow-lg flex justify-center items-center gap-2">Generate Magic</button>
                
                <div class="mt-4 pt-4 border-t">
                    <h3 class="text-xs font-bold text-gray-400 uppercase mb-2">History</h3>
                    <div id="historyList" class="space-y-2 max-h-32 overflow-y-auto text-sm text-gray-600"><p class="text-xs italic text-gray-400">Empty</p></div>
                </div>
            </div>
        </div>

        <div class="lg:col-span-7 bg-white p-6 rounded-xl shadow-sm min-h-[600px] flex flex-col">
            <h3 class="text-sm font-bold text-gray-400 uppercase mb-4">Live Preview</h3>
            <div id="previewContainer" class="flex-grow">
                <div class="flex flex-col items-center justify-center h-64 text-gray-300"><i class="fas fa-mobile-alt text-5xl mb-2"></i><p>Result will appear here</p></div>
            </div>
            <div id="magicButtons" class="hidden mt-4 pt-4 border-t flex flex-wrap gap-2">
                <button onclick="refine('Shorten it')" class="bg-purple-50 text-purple-700 px-3 py-1 rounded-full text-xs font-bold hover:bg-purple-100">‚úÇÔ∏è Shorten</button>
                <button onclick="refine('Add emojis')" class="bg-purple-50 text-purple-700 px-3 py-1 rounded-full text-xs font-bold hover:bg-purple-100">üòç Emojis</button>
                <button onclick="refine('Make it more engaging')" class="bg-purple-50 text-purple-700 px-3 py-1 rounded-full text-xs font-bold hover:bg-purple-100">üî• Spicy</button>
                <button onclick="copyText()" class="ml-auto bg-blue-50 text-blue-600 px-3 py-1 rounded-full text-xs font-bold hover:bg-blue-100">Copy</button>
            </div>
            <textarea id="rawText" class="hidden"></textarea>
        </div>
    </div>

    <script>
        window.onload = loadHistory;
        
        function setLength(val) {
            document.getElementById('length').value = val;
            ['lenShort', 'lenMedium', 'lenLong'].forEach(id => document.getElementById(id).classList.remove('active'));
            document.getElementById('len' + val).classList.add('active');
        }

        async function generate(refineInstr = null) {
            const data = {
                topic: document.getElementById('topic').value,
                platform: document.getElementById('platform').value,
                tone: document.getElementById('tone').value,
                length: document.getElementById('length').value,
                creativity: document.getElementById('creativity').value, // New
                language: document.getElementById('language').value,
                ai_model: document.getElementById('ai_model').value,
                refine_instruction: refineInstr,
                current_text: document.getElementById('rawText').value
            };
            if(!data.topic && !refineInstr) return alert("Please enter a topic!");
            const btn = document.getElementById('genBtn');
            btn.innerHTML = '<div class="loader"></div>'; btn.disabled = true;
            try {
                const res = await fetch('/generate', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(data) });
                const json = await res.json();
                const content = json.post_content || "Error.";
                document.getElementById('rawText').value = content;
                renderPreview(content);
                document.getElementById('magicButtons').classList.remove('hidden');
                if(!refineInstr) saveHistory(data.topic, content);
            } catch (e) { alert("Error: " + e); } 
            finally { btn.innerHTML = 'Generate Magic'; btn.disabled = false; }
        }
        function refine(instr) { generate(instr); }
        function renderPreview(text = null) {
            const content = text || document.getElementById('rawText').value;
            const platform = document.getElementById('platform').value;
            const html = content.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>').replace(/\n/g, '<br>');
            const container = document.getElementById('previewContainer');
            if(platform === 'Facebook') container.innerHTML = `<div class="preview-card p-4"><div class="flex items-center mb-3"><div class="w-10 h-10 bg-gray-300 rounded-full"></div><div class="ml-3"><div class="font-bold text-sm">Page Name</div><div class="text-xs text-gray-500">Just now</div></div></div><div class="text-sm text-gray-900">${html}</div></div>`;
            else if(platform === 'Instagram') container.innerHTML = `<div class="preview-card max-w-sm mx-auto"><div class="p-2 flex items-center gap-2 border-b"><div class="w-8 h-8 bg-gray-300 rounded-full"></div><span class="font-bold text-sm">username</span></div><div class="h-64 bg-gray-100 flex items-center justify-center text-gray-400"><i class="fas fa-image text-3xl"></i></div><div class="p-3 text-sm"><span class="font-bold mr-2">username</span>${html}</div></div>`;
            else container.innerHTML = `<div class="preview-card p-4 text-sm">${html}</div>`;
        }
        function saveHistory(t, c) {
            let h = JSON.parse(localStorage.getItem('aiH')) || [];
            h.unshift({t, c, d: new Date().toLocaleTimeString()});
            if(h.length>10) h.pop();
            localStorage.setItem('aiH', JSON.stringify(h));
            loadHistory();
        }
        function loadHistory() {
            const h = JSON.parse(localStorage.getItem('aiH')) || [];
            document.getElementById('historyList').innerHTML = h.length ? h.map((i,x) => `<div onclick="restore(${x})" class="cursor-pointer p-2 hover:bg-blue-50 rounded border border-gray-100 truncate text-xs font-bold text-blue-600">${i.t}</div>`).join('') : '<p class="text-xs italic text-gray-400">Empty</p>';
        }
        function restore(x) {
            const item = JSON.parse(localStorage.getItem('aiH'))[x];
            document.getElementById('rawText').value = item.c;
            renderPreview(item.c);
            document.getElementById('magicButtons').classList.remove('hidden');
        }
        function copyText() { navigator.clipboard.writeText(document.getElementById('rawText').value); alert("Copied!"); }
    </script>
    {% endif %}
</body>
</html>
